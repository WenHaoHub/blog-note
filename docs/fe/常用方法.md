## 公共方法

`在http://git.wisesoft.net.cn/SGE/project.git 脚手架中直接开发是方法可以直接使用 this.$.xxx 调用公共方法`

### ajax 请求

```js
const loading = this.$.loading(this.$loading, '提交中...');
this.$.ajax({
  headers = {},
  method,
  url,
  host = true,
  data = {},
  params = {},
  format = true,
  mix = false,
  defaults = false,
  loading,
  publicKey,
  secret
})then(res=>{}).catch();
```

| 参数      | 说明                                                            | 类型    | 可选值     | 默认值 |
| --------- | --------------------------------------------------------------- | ------- | ---------- | ------ |
| headers   | 请求头配置                                                      | object  | —          | {}     |
| method    | 请求方式                                                        | string  | get / post | get    |
| url       | 请求地址                                                        | string  | —          | —      |
| host      | baseURL                                                         | string  | —          | —      |
| data      | post 方式请求参数                                               | object  | —          | {}     |
| params    | get 方式请求参数                                                | object  | —          | {}     |
| format    | post 请求是否使用表单类型,并使用 qs 格式化,false 为 json 类型   | boolean | —          | true   |
| mix       | 是否混合使用 data、params 传参方式                              | boolean | —          | false  |
| defaults  | 是否传入默认参数 userId                                         | boolean | —          | false  |
| loading   | loading 加载对象，传入了 loading 会在请求完成后关闭对应 loading | object  | —          | —      |
| publicKey | sm2 加密公钥                                                    | string  | —          | —      |
| secret    | 要加密的字段属性名称                                            | array   | —          | 所有   |

### websocket 请求

```js
socket = this.$.socket({
  url: '/main2/ws',
  take: '/user/topic/all',
  success: (res) => {
    let data = res.data
    //处理data数据...

    // 若请求地址和订阅地址与示例值相同，可以用如下几种方式监听数据
    //在vux的mutation中添加websocket的方式监听数据变化做后续操作
    if (this.$store) {
      this.$store.commit('websocket', data)
    }
    /***
     * main.js中定义 Vue.prototype.$eventBus = new Vue();
     * 监听 this.$eventBus.$on('websocket', (data)=>{}
     *
     ***/
    if (this.$eventBus) {
      this.$eventBus.$emit('websocket', data)
    }
    /***
     * main.js中定义 window.eventBus = new Vue();
     * 监听 eventBus.$on('websocket', (data)=>{}
     *
     ***/
    if (window.eventBus) {
      window.eventBus.$emit('websocket', data)
    }
  },
})
//发送消息
socket.send({ id: 123123 })
//关闭socket,注：组件销毁时应该关闭
socket.destroy()
```

| 参数     | 说明                                          | 类型     | 可选值 | 默认值 |
| -------- | --------------------------------------------- | -------- | ------ | ------ |
| host     | 主机名称                                      | string   | —      | —      |
| url      | websocket 请求地址                            | string   | —      | —      |
| take     | 订阅地址                                      | string   | —      | —      |
| debug    | debug                                         | boolean  | —      | true   |
| interval | 重连间隔时间秒,小于这个这个将关闭 websocket， | number   | —      | 20     |
| success  | 连接成功回调函数                              | function | —      | —      |
| error    | 连接失败回调函数                              | function | —      | —      |

### arrUnique 数组元素对象去重(指定子元素对象属性名的值去重)

```js
arrUnique(data, key)
```

| 参数 | 说明               | 类型   | 可选值 | 默认值 |
| ---- | ------------------ | ------ | ------ | ------ |
| data | 原始数组           | array  | —      | —      |
| key  | 对象子元素的属性名 | string |        | —      |

### delUrlParam 删除 url 指定参数

```js
delUrlParam({ url, key })
```

| 参数 | 说明     | 类型   | 可选值 | 默认值 |
| ---- | -------- | ------ | ------ | ------ |
| url  | url 地址 | string | —      | —      |
| key  | 参数名   | string |        | —      |

### esmEncrypt sm2 加密

```js
esmEncrypt({ data, key, mode })
```

| 参数 | 说明           | 类型   | 可选值 | 默认值 |
| ---- | -------------- | ------ | ------ | ------ |
| data | 未加密的字符串 | string | —      | —      |
| key  | 公钥           | string |        | —      |
| mode | 类型           | number |        | 1      |

### esmDecode sm2 解密

```js
esmDecode({ data, key })
```

| 参数 | 说明           | 类型   | 可选值 | 默认值 |
| ---- | -------------- | ------ | ------ | ------ |
| data | 已加密的字符串 | string | —      | —      |
| key  | 私钥           | string |        | —      |
| mode | 类型           | number |        | 1      |

### extend 对象拷贝

```js
extend({},...);
extend(true,...);
```

| 参数         | 说明                              | 类型 | 可选值 | 默认值 |
| ------------ | --------------------------------- | ---- | ------ | ------ |
| arguments[0] | true:是否深度操作,{}:被扩展的对象 |      | —      | —      |

### formatDate 格式化时间

```js
formatDate(date, fmt)
```

| 参数 | 说明               | 类型   | 可选值 | 默认值 |
| ---- | ------------------ | ------ | ------ | ------ |
| date | 时间字符串或时间戳 | string | —      | —      |
| fmt  | 格式               | string |        | —      |

### getParams 获取 url 地址参数

```js
getParams(res)
```

| 参数 | 说明                                                     | 类型            | 可选值 | 默认值 |
| ---- | -------------------------------------------------------- | --------------- | ------ | ------ |
| res  | string:指定参数名称 / `{url:指定地址,name:指定参数名称}` | string / object | —      | —      |

### getStyle 获取元素样式（含非行内样式）

```js
getStyle(dom, attr)
```

| 参数 | 说明       | 类型   | 可选值 | 默认值 |
| ---- | ---------- | ------ | ------ | ------ |
| dom  | dom 元素   | string | —      | —      |
| attr | 样式属性名 | string | —      | —      |
